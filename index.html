<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>เมนูน้ำปั่นพรีเมียม</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<style type="text/tailwindcss">
    :root {
        --primary-mint: #48C9B0;
        --glass-bg: rgba(255, 255, 255, 0.04);
        --glass-border: rgba(255, 255, 255, 0.1);
    }
    body {
        font-family: 'Kanit', sans-serif;
        background-color: #0A0A0A;
    }
    .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border);
    }
    .glow-mint {
        box-shadow: 0 10px 30px -5px rgba(72, 201, 176, 0.4);
    }
    .header-blur {
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>
<style> body { min-height: max(884px, 100dvh); } </style>
</head>
<body class="text-white max-w-md mx-auto min-h-screen relative">
    <header class="p-6 flex justify-between items-center sticky top-0 z-50 bg-[#0A0A0A]/70 header-blur">
        <div class="flex flex-col">
            <span class="text-xs font-medium text-[var(--primary-mint)] uppercase tracking-wider">ร้านน้ำปั่น</span>
            <h1 class="text-2xl font-semibold tracking-tight">RanKaiNam</h1>
        </div>
        <div class="flex items-center gap-4">
            <a class="material-symbols-outlined text-gray-400 hover:text-white transition-colors" href="admin.html">settings</a>
            <div class="w-10 h-10 rounded-full border border-white/10 p-0.5 overflow-hidden">
                <img alt="Profile" class="w-full h-full object-cover rounded-full" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100"/>
            </div>
        </div>
    </header>

    <div class="px-6 mb-6 flex gap-3 overflow-x-auto no-scrollbar" id="category-list"></div>

    <main class="px-6 grid grid-cols-2 gap-5 pb-36" id="menu-grid"></main>

    <div class="fixed bottom-8 left-0 right-0 px-6 z-50 transition-all duration-300 transform translate-y-full" id="cart-bar">
        <a class="bg-[var(--primary-mint)] glow-mint h-16 rounded-full flex items-center justify-between px-6 text-black font-bold shadow-2xl transition-transform active:scale-95 overflow-hidden relative" href="basket.html">
            <div class="flex items-center gap-3">
                <div class="bg-black/10 w-8 h-8 rounded-full flex items-center justify-center relative">
                    <span class="material-symbols-outlined text-[20px]">shopping_bag</span>
                    <span class="absolute -top-1 -right-1 bg-black text-white text-[10px] w-4 h-4 flex items-center justify-center rounded-full border border-[var(--primary-mint)]" id="cart-count">0</span>
                </div>
                <span class="font-semibold text-sm">ดูตะกร้าสินค้า</span>
            </div>
            <div class="flex flex-col items-end leading-tight">
                <span class="text-lg" id="cart-total">฿ 0.00</span>
                <span class="text-[10px] uppercase opacity-60">รวมภาษีแล้ว</span>
            </div>
        </a>
    </div>

    <script>
        let currentFilter = 'ทั้งหมด';

        function loadData() {
            const menus = JSON.parse(localStorage.getItem('myMenus')) || [];
            
            // 1. สร้างหมวดหมู่ (ดึงเฉพาะที่ไม่ซ้ำกัน)
            const categories = ['ทั้งหมด', ...new Set(menus.map(m => m.category || 'ทั่วไป'))];
            
            const catList = document.getElementById('category-list');
            catList.innerHTML = categories.map(cat => `
                <span onclick="filterMenu('${cat}')" 
                      class="px-5 py-2 rounded-full text-sm font-medium whitespace-nowrap cursor-pointer transition-colors ${cat === currentFilter ? 'bg-[var(--primary-mint)] text-black font-semibold' : 'glass-card text-gray-400'}">
                    ${cat}
                </span>
            `).join('');

            // 2. เตรียมข้อมูลสินค้า (แนบ index เดิมไปด้วย เพื่อให้กดสั่งได้ถูกต้อง)
            const menusWithIndex = menus.map((m, originalIndex) => ({ ...m, originalIndex }));

            // 3. กรองสินค้า
            const filteredMenus = currentFilter === 'ทั้งหมด' 
                ? menusWithIndex 
                : menusWithIndex.filter(m => (m.category || 'ทั่วไป') === currentFilter);
            
            const grid = document.getElementById('menu-grid');
            
            if (filteredMenus.length === 0) {
                grid.innerHTML = '<p class="col-span-2 text-center text-gray-500 py-10">ยังไม่มีสินค้าในหมวดหมู่นี้</p>';
            } else {
                grid.innerHTML = filteredMenus.map(m => `
                    <div class="glass-card p-3 rounded-[2rem] flex flex-col group relative overflow-hidden">
                        <div class="relative mb-3">
                            <img src="${m.image}" class="rounded-[1.5rem] w-full aspect-square object-cover shadow-2xl">
                            <button onclick="addToCart(${m.originalIndex})" class="absolute bottom-2 right-2 bg-white/10 backdrop-blur-md text-white border border-white/20 rounded-full w-10 h-10 flex items-center justify-center hover:bg-[var(--primary-mint)] hover:text-black transition-all active:scale-90">
                                <span class="material-symbols-outlined text-[20px]">add</span>
                            </button>
                        </div>
                        <div class="px-1">
                            <h3 class="font-medium text-sm text-gray-100 line-clamp-1">${m.name}</h3>
                            <span class="text-[var(--primary-mint)] font-semibold mt-1 block">฿ ${m.price}</span>
                        </div>
                    </div>`).join('');
            }
            updateCartUI();
        }

        function filterMenu(cat) {
            currentFilter = cat;
            loadData();
        }

        // รับค่า index มาค้นหาข้อมูลใน localStorage แทนการรับค่าตรงๆ
        function addToCart(index) {
            const allMenus = JSON.parse(localStorage.getItem('myMenus')) || [];
            const item = allMenus[index]; // ดึงข้อมูลสินค้าตัวจริง

            if (!item) return;

            let cart = JSON.parse(localStorage.getItem('cartData')) || [];
            
            // เช็คว่ามีในตะกร้าหรือยัง
            let found = cart.find(x => x.name === item.name);
            if(found) {
                found.qty++; 
            } else {
                // บันทึกเฉพาะข้อมูลที่จำเป็น
                cart.push({
                    name: item.name, 
                    price: item.price, 
                    image: item.image, 
                    qty: 1
                });
            }
            
            localStorage.setItem('cartData', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            let cart = JSON.parse(localStorage.getItem('cartData')) || [];
            const count = cart.reduce((s,x)=>s+x.qty, 0);
            const total = cart.reduce((s,x)=>s+(x.price*x.qty), 0);
            
            document.getElementById('cart-count').innerText = count;
            document.getElementById('cart-total').innerText = '฿ ' + total.toLocaleString(undefined, {minimumFractionDigits: 2});
            
            const bar = document.getElementById('cart-bar');
            if (count > 0) bar.classList.remove('translate-y-full');
            else bar.classList.add('translate-y-full');
        }

        loadData();
    </script>
</body>
</html>