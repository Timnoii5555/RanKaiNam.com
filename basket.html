<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ตะกร้าสินค้าของคุณ</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<style type="text/tailwindcss">
    :root { --mint-primary: #48C9B0; --dark-bg: #0D0D0D; --surface: #1A1A1A; --ios-blur: rgba(26, 26, 26, 0.8); }
    body { background-color: var(--dark-bg); font-family: 'Kanit', sans-serif; color: white; }
    .confirm-btn-glow { box-shadow: 0 0 20px rgba(72, 201, 176, 0.3); }
    .divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent); }
    .item-card { background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 100%); }
</style>
<style> body { min-height: max(884px, 100dvh); } </style>
</head>
<body class="max-w-md mx-auto min-h-screen flex flex-col border-x border-white/5 relative overflow-x-hidden">
    <header class="px-6 py-4 flex items-center justify-between sticky top-0 bg-[var(--ios-blur)] backdrop-blur-xl z-50 mt-4">
        <a class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 active:bg-white/10 transition-colors" href="index.html">
            <span class="material-symbols-outlined !text-[20px]">chevron_left</span>
        </a>
        <h1 class="text-lg font-semibold tracking-wide">ตะกร้าของคุณ</h1>
        <button class="text-white/40 text-sm font-medium hover:text-red-400 transition-colors" onclick="clearCart()">ล้าง</button>
    </header>
    
    <main class="flex-1 px-6 py-4 space-y-6" id="cart-list"></main>
    
    <footer class="p-8 bg-[var(--surface)] rounded-t-[3rem] border-t border-white/5 shadow-2xl relative mt-auto">
        <div class="w-12 h-1 bg-white/10 rounded-full mx-auto mb-8"></div>
        <div class="space-y-4 mb-8">
            <div class="flex justify-between items-center text-white/40 text-sm"><span>ยอดรวมรายการ</span><span class="text-white font-medium" id="sub-total">฿ 0.00</span></div>
            <div class="flex justify-between items-center text-white/40 text-sm"><span>ค่าส่ง</span><span class="text-[var(--mint-primary)] font-medium">ฟรี</span></div>
            <div class="divider !bg-white/5"></div>
            <div class="flex justify-between items-center pt-2">
                <span class="text-lg font-medium">ยอดรวมสุทธิ</span>
                <div class="text-right">
                    <span class="text-2xl font-bold text-[var(--mint-primary)] tracking-tight" id="grand-total">฿ 0.00</span>
                    <p class="text-[10px] text-white/30 uppercase tracking-widest mt-1">รวมภาษีมูลค่าเพิ่มแล้ว</p>
                </div>
            </div>
        </div>
        <button class="confirm-btn-glow w-full bg-[var(--mint-primary)] text-[#0a2e28] font-bold py-5 rounded-[1.5rem] flex justify-between px-8 items-center active:scale-[0.98] transition-all group" onclick="confirmOrder()">
            <span class="text-lg">ยืนยันการสั่งซื้อ</span>
            <div class="flex items-center gap-2"><span class="text-sm opacity-60">ชำระเงิน</span><span class="material-symbols-outlined !text-[24px]">arrow_forward</span></div>
        </button>
        <div class="mt-6 flex justify-center"><div class="w-32 h-1 bg-white/20 rounded-full"></div></div>
    </footer>

    <script>
        function render() {
            let cart = JSON.parse(localStorage.getItem('cartData')) || [];
            const list = document.getElementById('cart-list');
            if (cart.length === 0) {
                list.innerHTML = '<div class="text-center py-20 text-gray-500">ไม่มีสินค้าในตะกร้า</div>';
                updateTotals(0);
                return;
            }
            let total = 0;
            list.innerHTML = cart.map((item, i) => {
                total += item.price * item.qty;
                return `
                <div class="item-card rounded-[2rem] p-4 flex gap-5 items-center border border-white/5">
                    <div class="relative w-24 h-24 overflow-hidden rounded-2xl bg-white/5 flex-shrink-0"><img class="w-full h-full object-cover" src="${item.image}"/></div>
                    <div class="flex-1 flex flex-col justify-between h-24 py-1">
                        <div><h3 class="font-medium text-white/90 leading-tight">${item.name}</h3><p class="text-[var(--mint-primary)] text-sm font-semibold mt-1">฿ ${item.price}</p></div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-1 bg-black/60 border border-white/5 rounded-full p-1 shadow-inner">
                                <button onclick="changeQty(${i}, -1)" class="w-8 h-8 flex items-center justify-center rounded-full text-white/60 active:scale-90 transition-transform"><span class="material-symbols-outlined text-lg">remove</span></button>
                                <span class="w-6 text-center text-sm font-bold">${item.qty}</span>
                                <button onclick="changeQty(${i}, 1)" class="w-8 h-8 flex items-center justify-center rounded-full bg-[var(--mint-primary)] text-black active:scale-90 transition-transform shadow-lg shadow-[#48C9B0]/20"><span class="material-symbols-outlined text-lg">add</span></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="divider"></div>`;
            }).join('');
            updateTotals(total);
        }

        function updateTotals(total) {
            const formatted = '฿ ' + total.toLocaleString();
            document.getElementById('sub-total').innerText = formatted;
            document.getElementById('grand-total').innerText = formatted;
        }

        function changeQty(idx, d) {
            let cart = JSON.parse(localStorage.getItem('cartData'));
            cart[idx].qty += d;
            if (cart[idx].qty <= 0) cart.splice(idx, 1);
            localStorage.setItem('cartData', JSON.stringify(cart));
            render();
        }

        function clearCart() { localStorage.removeItem('cartData'); render(); }

        function confirmOrder() {
            let cart = JSON.parse(localStorage.getItem('cartData')) || [];
            if (cart.length === 0) return alert('กรุณาเลือกสินค้าก่อนครับ');

            let lastNum = parseInt(localStorage.getItem('lastOrderNum')) || 0;
            lastNum++;
            localStorage.setItem('lastOrderNum', lastNum);
            let orderID = '#' + String(lastNum).padStart(3, '0');

            let kitchen = JSON.parse(localStorage.getItem('kitchenOrders')) || [];
            let newOrder = {
                id: orderID,
                items: cart,
                total: cart.reduce((s,x)=>s+(x.price*x.qty), 0),
                time: new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}),
                status: 'pending'
            };
            
            kitchen.push(newOrder);
            localStorage.setItem('kitchenOrders', JSON.stringify(kitchen));
            localStorage.setItem('currentOrder', JSON.stringify(newOrder));
            localStorage.removeItem('cartData');
            window.location.href = 'status.html';
        }
        render(); 
    </script>
</body>
</html>