<!DOCTYPE html>
<html class="dark" lang="th">
<head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ตะกร้า - RanKaiNam</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: "class", theme: { extend: { colors: { "primary": "#48C9B0", "background": "#121212" }, fontFamily: { "display": ["Kanit", "sans-serif"] } } } }
    </script>
</head>
<body class="bg-[#121212] font-display text-white max-w-md mx-auto min-h-screen flex flex-col border-x border-white/5 shadow-2xl">
    <header class="p-4 flex items-center justify-between border-b border-white/10 sticky top-0 bg-[#121212]/95 z-50">
        <a href="index.html" class="material-symbols-outlined">arrow_back_ios</a>
        <h1 class="font-bold">ตะกร้าของคุณ</h1>
        <button onclick="localStorage.removeItem('cartData'); renderCart();" class="text-red-400 text-sm">ล้าง</button>
    </header>

    <main id="cart-list" class="flex-1 p-4 space-y-4">
        </main>

    <footer class="p-6 bg-[#121212] border-t border-white/10 space-y-4">
        <div class="flex justify-between font-bold text-xl">
            <span>ยอดสุทธิ</span>
            <span id="grand-total" class="text-[#48C9B0]">฿ 0.00</span>
        </div>
        <button onclick="confirmOrder()" class="w-full bg-[#48C9B0] text-black font-extrabold py-4 rounded-2xl flex justify-between px-6 items-center shadow-lg active:scale-95 transition-all">
            <span>ยืนยันการสั่งซื้อ</span>
            <span class="material-symbols-outlined">arrow_forward</span>
        </button>
    </footer>

    <script>
        function renderCart() {
            let cart = JSON.parse(localStorage.getItem('cartData')) || [];
            const list = document.getElementById('cart-list');
            let total = 0;

            if (cart.length === 0) {
                list.innerHTML = `<div class="text-center py-20 opacity-30 italic">ไม่มีสินค้า...</div>`;
                document.getElementById('grand-total').innerText = '฿ 0.00';
                return;
            }

            list.innerHTML = cart.map((item, i) => {
                total += item.price * item.qty;
                return `
                <div class="bg-white/5 p-4 rounded-2xl flex gap-4 items-center border border-white/5">
                    <img src="${item.image}" class="w-16 h-16 rounded-xl object-cover">
                    <div class="flex-1">
                        <h3 class="font-bold text-sm">${item.name}</h3>
                        <p class="text-[#48C9B0] font-bold">฿ ${item.price}</p>
                    </div>
                    <div class="flex items-center gap-3 bg-black/40 rounded-full px-2 py-1">
                        <button onclick="changeQty(${i}, -1)" class="w-6 h-6 bg-gray-700 rounded-full font-bold">-</button>
                        <span class="text-sm font-bold">${item.qty}</span>
                        <button onclick="changeQty(${i}, 1)" class="w-6 h-6 bg-[#48C9B0] text-black rounded-full font-bold">+</button>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('grand-total').innerText = '฿ ' + total.toLocaleString();
        }

        function changeQty(idx, delta) {
            let cart = JSON.parse(localStorage.getItem('cartData'));
            cart[idx].qty += delta;
            if (cart[idx].qty <= 0) cart.splice(idx, 1);
            localStorage.setItem('cartData', JSON.stringify(cart));
            renderCart();
        }

        function confirmOrder() {
            let cart = JSON.parse(localStorage.getItem('cartData')) || [];
            if (cart.length === 0) return alert('เลือกเมนูก่อนครับ');

            // --- ระบบรันเลข Order ID #001 ---
            let lastNum = parseInt(localStorage.getItem('lastOrderNum')) || 0;
            lastNum++;
            localStorage.setItem('lastOrderNum', lastNum);
            let orderID = '#' + lastNum.toString().padStart(3, '0');

            let kitchen = JSON.parse(localStorage.getItem('kitchenOrders')) || [];
            let newOrder = { id: orderID, items: cart, time: new Date().toLocaleTimeString(), total: cart.reduce((s, it) => s + (it.price*it.qty), 0), table: 'A01' };

            kitchen.push(newOrder);
            localStorage.setItem('kitchenOrders', JSON.stringify(kitchen));
            localStorage.setItem('currentOrder', JSON.stringify(newOrder));
            localStorage.removeItem('cartData');
            window.location.href = 'status.html';
        }
        renderCart();
    </script>
</body>
</html>